<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Оформление абонемента</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #121212;
            color: white;
        }
        .navbar {
            background-color: #222;
        }
        .navbar-brand, .nav-link {
            color: #e60000 !important;
        }
        .nav-link:hover {
            color: #ff0000 !important;
        }
        .tariff-card {
            border: 1px solid #444;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            background-color: #333;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .tariff-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .tariff-card h5 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .tariff-card p {
            font-size: 16px;
            margin-bottom: 15px;
        }
        .tariff-card button {
            background-color: #e60000;
            border: none;
            font-size: 18px;
            width: 48%;
            margin-right: 4%;
            margin-bottom: 10px;
        }
        .tariff-card button:hover {
            background-color: #ff0000;
        }
        .tariff-card .btn:last-child {
            margin-right: 0;
        }
        .container {
            margin-top: 40px;
        }
        .list-group-item {
            background-color: #333;
            border: none;
            color: white;
        }
        .list-group-item input {
            margin-right: 10px;
        }
        .cart {
            background-color: #333;
            border-radius: 10px;
            padding: 20px;
            margin-top: 40px;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }
        .cart-item span {
            font-weight: bold;
        }
        .cart-item button {
            background-color: #e60000;
            border: none;
            color: white;
            padding: 5px 10px;
            cursor: pointer;
        }
        .cart-item button:hover {
            background-color: #ff0000;
        }
        .payment-button {
            width: 100%;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .modal-title {
        color: black !important;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">Спортивный клуб</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Переключить навигацию">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Главная</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="trainings.html">Тренировки</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="coaches.html">Тренера</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="membership.html">Абонементы</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="shop.html">Магазин</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="reviews.html">Отзывы</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="rental.html">Аренда</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="additional_services.html">Дополнительные услуги клуба</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="profile.html">Профиль</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#cartModal">
                            Корзина (<span id="cartCount">0</span>)
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
        <button id="roleToggleBtn" class="btn btn-secondary mb-3">Сменить роль</button>

<!-- Просмотр купленных абонементов (только для администратора) -->
<div class="container mt-4">
    <button id="viewPurchasesBtn" class="btn btn-warning togglePurchasesButton" style="display: none;" onclick="viewPurchasedSubscriptions()">Посмотреть купленные абонементы</button>
    <div id="subscriptionsListContainer" style="display: none;">
        <button class="btn btn-danger mb-3" onclick="toggleSubscriptionsList()">Закрыть</button>
        <ul id="subscriptionsList" class="list-group mt-4"></ul> <!-- Список купленных абонементов -->
    </div>
</div>


    <div class="container">
        <h2 class="mt-4">Оформление абонемента</h2>
        <p>Выберите абонемент, который вам подходит:</p>

        <div class="row">
            <!-- Абонемент на 1 месяц -->
            <div class="col-md-4 mb-4">
                <div class="tariff-card">
                    <img src="img/abonement1.jpg" alt="Абонемент 1 месяц">
                    <h5>Абонемент на 1 месяц</h5>
                    <p>Стоимость: 3000 руб.</p>
                    <p>Подходит для тех, кто хочет попробовать клуб или посещает редко.</p>
                    <div class="d-flex justify-content-between">
                        <button class="btn" onclick="addToCart('Абонемент на 1 месяц', 3000)">Выбрать</button>
                    </div>
                </div>
            </div>

            <!-- Абонемент на 6 месяцев -->
            <div class="col-md-4 mb-4">
                <div class="tariff-card">
                    <img src="img/abonement2.jpg" alt="Абонемент 6 месяцев">
                    <h5>Абонемент на 6 месяцев</h5>
                    <p>Стоимость: 15000 руб.</p>
                    <p>Подходит для тех, кто планирует посещать клуб регулярно.</p>
                    <div class="d-flex justify-content-between">
                        <button class="btn" onclick="addToCart('Абонемент на 6 месяцев', 15000)">Выбрать</button>
                    </div>
                </div>
            </div>

            <!-- Абонемент на 12 месяцев -->
            <div class="col-md-4 mb-4">
                <div class="tariff-card">
                    <img src="img/abonement3.jpg" alt="Абонемент 12 месяцев">
                    <h5>Абонемент на 12 месяцев</h5>
                    <p>Стоимость: 27000 руб.</p>
                    <p>Идеален для тех, кто серьезно настроен на тренировки.</p>
                    <div class="d-flex justify-content-between">
                        <button class="btn" onclick="addToCart('Абонемент на 12 месяцев', 27000)">Выбрать</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="cartModal" class="modal fade" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <!-- Заголовок с чёрным цветом -->
                        <h5 class="modal-title" id="cartModalLabel" style="color: black;">Ваша корзина</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="cart">
                            <ul class="list-group">
                                <li class="list-group-item">В корзине нет товаров</li>
                            </ul>
                        </div>
                        <div class="mt-4">
                            <h4 style="color: black;">Итого: <span id="totalPrice">0</span> руб.</h4>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                        <button type="button" class="btn btn-primary" onclick="proceedToPayment()">Перейти к оплате</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Модальное окно для завершения покупки -->
        <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="paymentModalLabel">Оплата</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <h5 style="color: black;">Общая сумма: <span id="paymentTotalPrice">0</span> руб.</h5>
                        <button class="btn btn-success payment-button" onclick="payWithSBP()">Оплатить через СБП</button>
                        <button class="btn btn-danger payment-button" onclick="completePayment()">Завершить покупку</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        let cartItems = [];

        // Добавление товара в корзину
        function addToCart(name, price) {
            const item = { name, price };
            cartItems.push(item);
            updateCartDisplay();
        }

        // Обновление отображения корзины
        function updateCartDisplay() {
            const cart = document.getElementById("cart");
            const cartCount = document.getElementById("cartCount");
            let total = 0;
            cart.innerHTML = '';
            
            cartItems.forEach(item => {
                total += item.price;
                const listItem = document.createElement("li");
                listItem.classList.add("list-group-item");
                listItem.textContent = `${item.name}: ${item.price} руб.`;
                cart.appendChild(listItem);
            });
            
            document.getElementById("totalPrice").textContent = total;
            cartCount.textContent = cartItems.length;
        }

        // Переход к оплате
        function proceedToPayment() {
            const total = cartItems.reduce((sum, item) => sum + item.price, 0);
            document.getElementById('paymentTotalPrice').textContent = total;
            const paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
            paymentModal.show();
        }

        // Оплата через СБП
        function payWithSBP() {
            alert("Вы выбрали оплату через СБП. Пожалуйста, следуйте инструкциям на экране.");
            completePayment();
        }

        // Завершение покупки
        function completePayment() {
            alert('Покупка завершена! Спасибо за покупку.');

            // Отправка данных на сервер для сохранения в БД
            cartItems.forEach(item => {
                fetch('http://localhost:3000/purchase', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: item.name,
                        price: item.price
                    })
                })
                .then(response => {
                    if (response.ok) {
                        console.log('Покупка записана в базу данных');
                    } else {
                        console.error('Ошибка при записи в базу данных');
                    }
                })
                .catch(error => {
                    console.error('Ошибка при отправке данных на сервер:', error);
                });
            });

            // Очищаем корзину
            cartItems.length = 0;
            document.getElementById('cartCount').textContent = `0`;
            document.getElementById('cart').innerHTML = '<li class="list-group-item">В корзине нет товаров</li>';
            document.getElementById('totalPrice').textContent = '0';
            const paymentModal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
            paymentModal.hide();  // Закрываем модальное окно оплаты
        }

        let currentRole = 'user'; // Начальная роль - пользователь

        // Переключение ролей
        document.getElementById('roleToggleBtn').addEventListener('click', function () {
            if (currentRole === 'admin') {
                currentRole = 'user'; // Переключаем на пользователя
                alert('Вы вошли как пользователь');
            } else {
                currentRole = 'admin'; // Переключаем на администратора
                alert('Вы вошли как администратор');
            }

            toggleRoleFeatures(); // Обновляем видимость кнопок
        });

        // Управление доступом к кнопке "Посмотреть купленные абонементы"
        function toggleRoleFeatures() {
            const viewPurchasesBtn = document.getElementById('viewPurchasesBtn');
            
            // Показываем кнопку "Посмотреть купленные абонементы" только для администратора
            if (currentRole === 'admin') {
                viewPurchasesBtn.style.display = 'block';
            } else {
                viewPurchasesBtn.style.display = 'none';
            }
        }

        // Показать список купленных абонементов (только для администратора)
        function viewPurchasedSubscriptions() {
            fetch('http://localhost:3000/get-purchased-subscriptions') // Запрос к серверу на получение данных
                .then(response => response.json())
                .then(data => {
                    const subscriptionsList = document.getElementById('subscriptionsList');
                    subscriptionsList.innerHTML = ''; // Очищаем список

                    data.forEach(subscription => {
                        const listItem = document.createElement('li');
                        listItem.classList.add('list-group-item');
                        listItem.textContent = `Абонемент: ${subscription.name}, Цена: ${subscription.price} руб.`;
                        subscriptionsList.appendChild(listItem);
                    });
                })
                .catch(error => {
                    console.error('Ошибка при получении данных:', error);
                });
        }
        // Функция для показа/скрытия списка купленных абонементов
function toggleSubscriptionsList() {
    const subscriptionsListContainer = document.getElementById('subscriptionsListContainer');
    const viewPurchasesBtn = document.getElementById('viewPurchasesBtn');

    // Если список скрыт, показываем его
    if (subscriptionsListContainer.style.display === 'none') {
        subscriptionsListContainer.style.display = 'block';
        viewPurchasesBtn.style.display = 'none'; // Скрываем кнопку "Посмотреть абонементы"
    } else {
        subscriptionsListContainer.style.display = 'none';
        viewPurchasesBtn.style.display = 'block'; // Показываем кнопку "Посмотреть абонементы"
    }
}

// Функция для отображения списка купленных абонементов (только для администратора)
function viewPurchasedSubscriptions() {
    fetch('http://localhost:3000/get-purchased-subscriptions') // Запрос к серверу на получение данных
        .then(response => response.json())
        .then(data => {
            const subscriptionsList = document.getElementById('subscriptionsList');
            subscriptionsList.innerHTML = ''; // Очищаем список

            data.forEach(subscription => {
                const listItem = document.createElement('li');
                listItem.classList.add('list-group-item');
                listItem.textContent = `Абонемент: ${subscription.name}, Цена: ${subscription.price} руб.`;
                subscriptionsList.appendChild(listItem);
            });

            // После того как данные загружены, показываем список
            toggleSubscriptionsList();
        })
        .catch(error => {
            console.error('Ошибка при получении данных:', error);
        });
}

        // Инициализируем состояние отображения кнопок
        toggleRoleFeatures();
    </script>
</body>
</html>
