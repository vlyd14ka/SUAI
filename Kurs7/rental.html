<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Аренда залов и дополнительные услуги</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <style>
        .rental-item img {
            width: 100%;
            height: auto;
        }
        .rental-item {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .rental-item .card-body {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
        }
        .rental-item .btn {
            margin-top: auto;
        }
        .row {
            margin-top: 20px;
        }
        .contact-form {
            display: none;
            margin-top: 20px;
        }
        .admin-controls {
            margin-top: 20px;
        }
        .admin-controls .btn {
            margin-right: 10px;
        }
    </style>
</head>
<body>

    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">Спортивный клуб</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Переключить навигацию">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Главная</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="trainings.html">Тренировки</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="coaches.html">Тренера</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="membership.html">Абонементы</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="shop.html">Магазин</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="reviews.html">Отзывы</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="rental.html">Аренда залов и дополнительные услуги</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="profile.html">Профиль</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <button class="btn btn-secondary mb-3" onclick="toggleRole()">Сменить роль</button>
    <div class="container">
        <h2 class="mt-5">Аренда инвентаря и залов</h2>
        
        <!-- Кнопки смены ролей и администрирования -->
        <div class="admin-controls">
            <button class="btn btn-info" onclick="viewAllBookings()" style="display: none;">Посмотреть все бронирования</button>
            <div id="booking-list" class="mt-4"></div>
        </div>

        <!-- Аренда залов -->
        <h3 class="mt-4">Аренда залов</h3>
        <p>Выберите зал для аренды:</p>
        <div class="row">
            <!-- Зал 1 (Силовые тренировки) -->
            <div class="col-md-4">
                <div class="card rental-item">
                    <img src="img/zal_1.jpg" alt="Зал 1">
                    <div class="card-body">
                        <h5 class="card-title">Зал 1 - Силовые тренировки</h5>
                        <p>Время: 10:00 - 14:00</p>
                        <p>Описание: Зал для силовых тренировок, оснащён современными тренажерами.</p>
                        <button class="btn btn-primary" onclick="showContactForm(this, 'Зал 1 - Силовые тренировки')">Забронировать</button>
                        <div class="contact-form">
                            <p>Для бронирования введите ваш телефон:</p>
                            <input type="tel" class="form-control" placeholder="Введите номер телефона" required>
                            <button class="btn btn-success mt-2" onclick="submitContactForm(this)">Отправить</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Зал 2 (Фитнес) -->
            <div class="col-md-4">
                <div class="card rental-item">
                    <img src="img/zal_2.jpg" alt="Зал 2">
                    <div class="card-body">
                        <h5 class="card-title">Зал 2 - Фитнес</h5>
                        <p>Время: 14:00 - 18:00</p>
                        <p>Описание: Зал для фитнес тренировок, подходит для кардио и групповых занятий.</p>
                        <button class="btn btn-primary" onclick="showContactForm(this, 'Зал 2 - Фитнес')">Забронировать</button>
                        <div class="contact-form">
                            <p>Для бронирования введите ваш телефон:</p>
                            <input type="tel" class="form-control" placeholder="Введите номер телефона" required>
                            <button class="btn btn-success mt-2" onclick="submitContactForm(this)">Отправить</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Зал 3 (Боевые искусства) -->
            <div class="col-md-4">
                <div class="card rental-item">
                    <img src="img/zal_3.jpg" alt="Зал 3">
                    <div class="card-body">
                        <h5 class="card-title">Зал 3 - Боевые искусства</h5>
                        <p>Время: 18:00 - 22:00</p>
                        <p>Описание: Зал для тренировок по боевым искусствам, оборудован необходимым инвентарём.</p>
                        <button class="btn btn-primary" onclick="showContactForm(this, 'Зал 3 - Боевые искусства')">Забронировать</button>
                        <div class="contact-form">
                            <p>Для бронирования введите ваш телефон:</p>
                            <input type="tel" class="form-control" placeholder="Введите номер телефона" required>
                            <button class="btn btn-success mt-2" onclick="submitContactForm(this)">Отправить</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Аренда инвентаря -->
        <h3 class="mt-5">Дополнительные услуги</h3>
        <p>Выберите доп. услугу:</p>
        <div class="row">
            <div class="col-md-4">
                <div class="card rental-item">
                    <img src="img/sauna.jpg" alt="Сауна">
                    <div class="card-body">
                        <h5 class="card-title">Сауна</h5>
                        <p>Для полного расслабления и восстановления предлагается посещение сауны после тренировки. Отлично для улучшения кровообращения и снятия напряжения.</p>
                        <button class="btn btn-primary" onclick="showContactForm(this, 'Сауна')">Забронировать</button>
                        <div class="contact-form">
                            <p>Для бронирования введите ваш телефон:</p>
                            <input type="tel" class="form-control" placeholder="Введите номер телефона" required>
                            <button class="btn btn-success mt-2" onclick="submitContactForm(this)">Отправить</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card rental-item">
                    <img src="img/spa.jpg" alt="СПА">
                    <div class="card-body">
                        <h5 class="card-title">SPA</h5>
                        <p>Для тех, кто хочет получить максимум удовольствия и пользы от тренировок, предлагается расслабляющие SPA-процедуры, чтобы восстановить силы и улучшить самочувствие.</p>
                        <button class="btn btn-primary" onclick="showContactForm(this, 'SPA')">Забронировать</button>
                        <div class="contact-form">
                            <p>Для бронирования введите ваш телефон:</p>
                            <input type="tel" class="form-control" placeholder="Введите номер телефона" required>
                            <button class="btn btn-success mt-2" onclick="submitContactForm(this)">Отправить</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
let isAdmin = false;  // Начальный статус пользователя (Пользователь)
let isBookingsVisible = false;  // Переменная для отслеживания видимости списка бронирований

// Функция для переключения роли
function toggleRole() {
    isAdmin = !isAdmin;
    const bookingButton = document.querySelector('.admin-controls .btn-info');

    if (isAdmin) {
        alert('Вы перешли в роль администратора');
        bookingButton.style.display = 'inline-block';
    } else {
        alert('Вы перешли в роль пользователя');
        bookingButton.style.display = 'none';
    }
}

// Функция для отображения списка бронирований
function viewAllBookings() {
    if (isAdmin) {
        const bookingListContainer = document.getElementById('booking-list');

        // Если список скрыт, показываем его
        if (!isBookingsVisible) {
            // Отправляем запрос на сервер для получения всех бронирований
            fetch('http://localhost:3000/rentals')
                .then(response => response.json())
                .then(data => {
                    bookingListContainer.innerHTML = '';  // Очищаем контейнер

                    if (data.length === 0) {
                        bookingListContainer.innerHTML = '<p>Нет доступных бронирований.</p>';
                    } else {
                        // Отображаем все бронирования
                        data.forEach(booking => {
                            const bookingItem = document.createElement('div');
                            bookingItem.classList.add('mb-3');
                            bookingItem.innerHTML = `
                                <div>
                                    <h5>${booking.item}</h5>
                                    <p><strong>Дата аренды:</strong> ${booking.rental_date}</p>
                                    <p><strong>Дата возврата:</strong> ${booking.return_date}</p>
                                    <p><strong>Телефон:</strong> ${booking.phone}</p>
                                </div>
                                <hr>
                            `;
                            bookingListContainer.appendChild(bookingItem);
                        });
                    }

                    // Переключаем видимость списка
                    isBookingsVisible = true;
                    // Меняем текст на кнопке
                    document.querySelector('.admin-controls .btn-info').textContent = 'Скрыть все бронирования';
                })
                .catch(error => {
                    console.error('Ошибка при получении данных:', error);
                    alert('Не удалось получить данные о бронированиях.');
                });
        } else {
            // Если список виден, скрываем его
            bookingListContainer.innerHTML = '';  // Очищаем контейнер
            isBookingsVisible = false;  // Меняем состояние на скрытое
            // Меняем текст на кнопке
            document.querySelector('.admin-controls .btn-info').textContent = 'Посмотреть все бронирования';
        }
    } else {
        alert('Только администратор может просматривать все бронирования.');
    }
}

// Функция для отображения формы для связи
function showContactForm(button, item) {
    const contactForm = button.parentElement.querySelector('.contact-form');
    contactForm.style.display = 'block';
    button.style.display = 'none';
    contactForm.dataset.item = item;
}

// Функция для отправки формы
function submitContactForm(button) {
    const phoneInput = button.parentElement.querySelector('input[type="tel"]');
    const item = button.parentElement.dataset.item;

    if (phoneInput.value) {
        fetch('/submit_rental', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                item: item,
                rental_date: new Date().toISOString().split('T')[0],
                return_date: new Date(new Date().getTime() + 2 * 60 * 60 * 1000).toISOString().split('T')[0],
                phone: phoneInput.value,
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Ваша заявка отправлена! Менеджер свяжется с вами.');
                button.parentElement.style.display = 'none';
                button.parentElement.parentElement.querySelector('.btn').style.display = 'block';
            } else {
                alert('Ошибка при отправке данных. Попробуйте снова.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Ошибка при отправке данных. Попробуйте снова.');
        });
    } else {
        alert('Пожалуйста, введите номер телефона.');
    }
}

    </script>
</body>
</html>
